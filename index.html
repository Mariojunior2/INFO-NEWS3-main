<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Notícias em PDF</title>
  <link rel="stylesheet" href="assets/css/style.css">

</head>
<body>
  <h1> INFO NEWS </h1>
  <div id="pdf-container">
    <canvas id="pdf-render"></canvas>
    <button type="button" class="open-modal" id="open-modal">Abrir Jornal</button>
    <div class="nav-inline">
      <button type="button" id="prev">←</button>
      <button type="button" id="next">→</button>
    </div>
  </div>


  <div id="pdf-modal">
    <div class="modal-content">
      <canvas id="modal-render"></canvas>
    </div>
    <button type="button"  class="close-modal" id="modal-close">✕</button>
    <div class="modal-nav">
      <button type="button" id="modal-prev">←</button>
      <button type="button"  id="modal-next">→</button>
    </div>
    <div class="page-indicator" id="modal-page-num">1 / 1</div>
  </div>

  <script type="module">
    import * as pdfjsLib from './assets/pdfjs/pdf.mjs';
    pdfjsLib.GlobalWorkerOptions.workerSrc = './assets/pdfjs/pdf.worker.mjs';
    document.addEventListener('DOMContentLoaded', () => {
      const url = './assets/noticias/jornal.pdf'; let pdfDoc=null, pageNum=1;
      const canvas = document.getElementById('pdf-render'), ctx = canvas.getContext('2d');
      const modal = document.getElementById('pdf-modal');
      const mCanvas = document.getElementById('modal-render'), mCtx = mCanvas.getContext('2d');
      const pageInd = document.getElementById('modal-page-num');

      const anterior = document.getElementById('prev');
      const proximo = document.getElementById('next');
      
      async function render(p, c, cx, sc=1.5) {
        const pg = await pdfDoc.getPage(p);
        const vp = pg.getViewport({ scale: sc });
        c.width = vp.width; c.height = vp.height;
        await pg.render({ canvasContext: cx, viewport: vp }).promise;
        pageInd.textContent = p + ' / ' + pdfDoc.numPages;
      }

      pdfjsLib.getDocument(url).promise.then(pdf => { pdfDoc = pdf; render(pageNum, canvas, ctx); });
      if (modal.style.display != 'flex') {
        anterior.style.display = 'none';
        proximo.style.display = 'none';
      } else {
        anterior.style.display = 'flex';
        proximo.style.display = 'flex';
      }

      anterior.onclick = () => { if (pageNum > 1) render(--pageNum, canvas, ctx); };
      proximo.onclick = () => { if (pageNum < pdfDoc.numPages) render(++pageNum, canvas, ctx); };
      document.getElementById('open-modal').onclick = () => { modal.style.display='flex'; render(pageNum,mCanvas,mCtx,2);};
      document.getElementById('modal-close').onclick = () => { modal.style.display='none'; };
      document.addEventListener('keydown', e => { if(e.key==='Escape') modal.style.display='none'; });
      document.getElementById('modal-prev').onclick = () => { if(pageNum>1) render(--pageNum, mCanvas, mCtx,2); };
      document.getElementById('modal-next').onclick = () => { if(pageNum<pdfDoc.numPages) render(++pageNum, mCanvas, mCtx,2); };
    });
  </script>
</body>
</html>
